# Release 20: else if + ES Modules

## Status: PLANNING

## Overview

1. Add `else if` syntax to avoid deeply nested conditionals
2. Migrate codebase to ES modules (import/export)

---

## Deferred to Future Release

### Dictionaries
Add dictionary data type (key-value pairs) to enable:
- Mapping keys to values: `let beats = {"r": "s", "p": "r", "s": "p"}`
- Lookup by key: `beats["r"]` returns `"s"`
- Replacing chains of conditionals with data-driven lookups

**Benefit:** The RPS example currently needs 9 explicit conditions to check all win/tie/lose cases. With dictionaries, it becomes a single lookup: `if (beats[player] equals computer) { ... }`

---

## Feature 1: else if

### Current Problem
Without `else if`, multi-way branches require deep nesting:

```
if (op equals "+") {
  result = a + b
} else {
  if (op equals "-") {
    result = a - b
  } else {
    if (op equals "*") {
      result = a * b
    } else {
      result = a / b
    }
  }
}
```

### With else if
```
if (op equals "+") {
  result = a + b
} else if (op equals "-") {
  result = a - b
} else if (op equals "*") {
  result = a * b
} else {
  result = a / b
}
```

### Implementation

**Parser change** (`src/parser.js`):

Currently `parseIfStatement()` parses:
```
if (condition) { ... } else { ... }
```

Need to also accept:
```
if (condition) { ... } else if (condition2) { ... } else { ... }
```

The `else if` is syntactic sugar - it parses as `else { if ... }` but without requiring braces.

**Grammar:**
```
ifStatement = "if" "(" expression ")" block ("else" (ifStatement | block))?
```

**Files to modify:**
- `src/parser.js` - Update `parseIfStatement()`
- `language-help.html` - Document `else if`
- `tests/interpreter.spec.js` - Add tests
- Example programs - Simplify nested if/else chains

### Tests to Add

All tests are **end-to-end Playwright tests** (no unit tests). Tests work by:
1. Navigate to page
2. Fill `#code-editor` with test code
3. Click `#run-btn` (or `#parse-btn` for parser tests)
4. Check `#output` or AST panel for expected result

**Parser tests** (`tests/parser.spec.js`):
- `else if parses correctly` - Verify AST structure
- `else if chain parses correctly` - Multiple else if branches
- `else if with final else parses correctly`

**Interpreter tests** (`tests/interpreter.spec.js`):
- `else if executes first matching branch` - First condition true
- `else if executes second branch` - Second condition true
- `else if executes else branch` - No conditions true
- `else if skips remaining branches after match` - Verify short-circuit
- `else if chain with multiple conditions` - 3+ branches

**Example test scenarios:**
```
// Test 1: First branch matches
let x = 1
if (x equals 1) {
  print("one")
} else if (x equals 2) {
  print("two")
} else {
  print("other")
}
// Output: "one"

// Test 2: Second branch matches
let x = 2
if (x equals 1) {
  print("one")
} else if (x equals 2) {
  print("two")
} else {
  print("other")
}
// Output: "two"

// Test 3: Else branch matches
let x = 99
if (x equals 1) {
  print("one")
} else if (x equals 2) {
  print("two")
} else {
  print("other")
}
// Output: "other"

// Test 4: Long chain
let grade = 85
if (grade >= 90) {
  print("A")
} else if (grade >= 80) {
  print("B")
} else if (grade >= 70) {
  print("C")
} else if (grade >= 60) {
  print("D")
} else {
  print("F")
}
// Output: "B"
```

### Example Programs to Update
- `calculator.js` - 4 levels → flat
- `rps.js` - 6 levels → flat
- `control-flow.js` - Add `else if` example
- `dice.js` - Nested checks → flat

---

## Archive: Example Program Comment Statistics

Snapshot from Release 19 session for tracking documentation quality.

| Example | Total LOC | Comments | % Comments |
|---------|-----------|----------|------------|
| fizzbuzz | 33 | 14 | 42.4% |
| tokenizer-demo | 18 | 7 | 38.8% |
| arithmetic | 16 | 5 | 31.2% |
| comparisons | 18 | 5 | 27.7% |
| fibonacci | 31 | 8 | 25.8% |
| primes | 56 | 14 | 25.0% |
| variables | 16 | 4 | 25.0% |
| arrays | 23 | 5 | 21.7% |
| towers-of-hanoi | 176 | 38 | 21.5% |
| strings | 39 | 8 | 20.5% |
| flappy-bird | 73 | 13 | 17.8% |
| drawing | 45 | 8 | 17.7% |
| pong | 63 | 11 | 17.4% |
| bouncing-ball | 30 | 5 | 16.6% |
| game-of-life | 143 | 23 | 16.0% |
| operators | 35 | 5 | 14.2% |
| starfield | 58 | 8 | 13.7% |
| breakout | 110 | 15 | 13.6% |
| functions | 39 | 5 | 12.8% |
| control-flow | 48 | 6 | 12.5% |
| snake | 82 | 10 | 12.1% |
| maze-generator | 190 | 21 | 11.0% |
| computer-guesses | 34 | 3 | 8.8% |
| guess-number | 25 | 2 | 8.0% |
| tetris | 180 | 14 | 7.7% |
| dice | 26 | 2 | 7.6% |
| maze-solver | 308 | 21 | 6.8% |
| calculator | 31 | 2 | 6.4% |
| rps | 70 | 4 | 5.7% |

**Average: ~17%** | Well-commented (>25%): 7 | Under-commented (<10%): 6

---

## Feature 2: ES Modules

### Current State

The codebase uses global `window` object pattern:
- Files attach to globals: `window.EXAMPLES['name'] = {...}`
- Scripts loaded via `<script>` tags in dependency order
- No explicit imports/exports
- Dependencies are implicit and order-dependent

### Benefits

1. **Explicit dependencies** - Each file declares what it needs
2. **No global pollution** - No more `window.X` pattern
3. **Better tooling** - IDEs can track imports/exports
4. **Modern standard** - Supported natively in all modern browsers

### Migration Plan

**Phase 1: Convert Core Files** (in dependency order)
1. `src/constants.js` - No dependencies, pure exports
2. `src/utils.js` - No dependencies, pure exports
3. `src/lexer.js` - Uses constants
4. `src/scanner.js` - Uses lexer
5. `src/parser.js` - Uses lexer
6. `src/runtime.js` - Uses constants
7. `src/interpreter.js` - Uses parser, runtime, lexer

**Phase 2: Convert Renderers**
8. `src/ast-renderer.js`
9. `src/parser-renderer.js`
10. `src/output-renderer.js`
11. `src/memory-renderer.js`

**Phase 3: Convert UI Files**
12. `src/visualizer.js` - Uses all renderers
13. `src/modal.js`
14. `src/main.js` - Entry point, imports everything

**Phase 4: Convert Examples**
15. Individual example files export their example object
16. `src/examples.js` - Aggregates all examples

**Phase 5: Update HTML**
17. Change to single entry point: `<script type="module" src="src/main.js"></script>`

### Example Transformation

**Before (constants.js):**
```javascript
const TokenType = {
  NUMBER: 'NUMBER',
  // ...
};
// Implicitly global
```

**After (constants.js):**
```javascript
export const TokenType = {
  NUMBER: 'NUMBER',
  // ...
};
```

**Before (lexer.js):**
```javascript
// Uses global TokenType
function tokenize(source) {
  return { type: TokenType.NUMBER, ... };
}
```

**After (lexer.js):**
```javascript
import { TokenType } from './constants.js';

export function tokenize(source) {
  return { type: TokenType.NUMBER, ... };
}
```
